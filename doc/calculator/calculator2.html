<!DOCTYPE html>
<html>

<head>
  <title>Simple Calculator</title>
  <link rel="stylesheet" href="calc.style" type="text/css" />
</head>

<body>
  <table id="calculator" 
    click:is_number:add_number 
    _keypress:is_number:add_number
    click:is_operator:do_operator 
    _keypress:is_operator:do_operator>
    <tr>
      <td hidden id="result"></td>
      <td hidden id="operation"></td>
      <td id="input"></td>
      <td class="operator">clear</td>
    </tr>
    <tr>
      <td class="number">1</td>
      <td class="number">2</td>
      <td class="number">3</td>
      <td class="operator">/</td>
    </tr>
    <tr>
      <td class="number">4</td>
      <td class="number">5</td>
      <td class="number">6</td>
      <td class="operator">*</td>
    </tr>
    <tr>
      <td class="number">7</td>
      <td class="number">8</td>
      <td class="number">9</td>
      <td class="operator">-</td>
    </tr>
    <tr>
      <td class="number">0</td>
      <td class="number">.</td>
      <td class="operator">=</td>
      <td class="operator">+</td>
    </tr>
  </table>

  <script>
    // filters
    // 1. illustrate how we retrieve data from the event and from the target in the dom.
    //    no need to add lots of attribute or elements, if we can read the state directly 
    //    from either the event or the dom.
    // 2. illustrate that we pass along the filtered output to the next reaction in the chain
    //    and illustrate how we break the chain.
    customReactions.define("is_number", function (e) {
      if (e.type === "keypress" && e.key.matches(/0-9/))
        return e.key;
      if (e.type === "click" && e.target.innerText.matches(/0-9/))
        return e.target.innerText;
      throw customReactions.break;
    });
    customReactions.define("is_operator", function (e) {
      if (e.type === "keypress") {
        if (e.key === "Esc")
          return "clear";
        if (["=", "+", "-", "/", "*"].indexOf(e.key) >= 0)
          return e.key;
      }
      if (e.type === "click") {
        const targetTxt = e.target.innerText;
        if (["=", "+", "-", "/", "*", "clear"].indexOf(targetTxt) >= 0)
          return targetTxt;
      }
      throw customReactions.break;
    });
  
    //reducers
    //1. illustrate how we can get data from previous reactions using the `i` argument.
    //2. illustrate how we can get dom nodes we can change. 
    //   Important tip: 1. add the reactions around both the trigger elements and the to-be-changed elements. This way, you can likely catch many triggers with the same custom reaction, and it is safe to find the right dom element with less chance of it being confused with another part of your dom. Add custom reactions to the shared ancestor.
    customReactions.define("do_operator", function (e, i) {
      const input = this.ownerElement.querySelector("#input");
      const result = this.ownerElement.querySelector("#result");
      // if there is no result, then add the input to the result and the operator to the id=operator. and then return

      // if there is a 
      if (i === "=") {
        result.innerText = input.innerText;
        input.innerText = "";
      } else if (i === "+") {
        result.innerText = parseFloat(result.innerText) + parseFloat(input.innerText);
        input.innerText = "";
      } else if (i === "-") {
        result.innerText = parseFloat(result.innerText) - parseFloat(input.innerText);
        input.innerText = "";
      } else if (i === "/") {
        result.innerText = parseFloat(result.innerText) / parseFloat(input.innerText);
        input.innerText = "";
      } else if (i === "*") {
        result.innerText = parseFloat(result.innerText) * parseFloat(input.innerText);
        input.innerText = "";
      } else if (i === "clear") {
        result.innerText = "";
        input.innerText = "";
      }
    });
    customReactions.define("add_number", function (e, i) {
      const input = this.ownerElement.querySelector("#input");
      if (i === "." && input.innerText.indexOf(".") >= 0)
        return;
      input.innerText += i;
    });
  </script>
</body>

</html>