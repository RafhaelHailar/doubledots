<script type="module">
  import { toCss } from "./Xengine.js";

  const units = {
    "$flex(row-reverse, p(1%,,3%), gap(,3rem))":
/*css*/`/*container 0*/
/*$flex(row-reverse, p(1%,,3%), gap(,3rem))*/
:where(.\\$flex\\(row-reverse\\,\\ p\\(1\\%\\,\\,3\\%\\)\\,\\ gap\\(\\,3rem\\)\\)) {
  display: flex;
  flex-direction: row-reverse;
  padding-block-start: 1%;
  padding-block-end: 3%;
  gap-row: 3rem;
}`,
    "$border(radius(1rem))":
/*css*/`/*container 0*/
/*$border(radius(1rem))*/
:where(.\\$border\\(radius\\(1rem\\)\\)) {
  border-radius: 1rem;
}`,
    "$border(w(,1px,2px), s(,,solid,dashed))":
/*css*/`/*container 0*/
/*$border(w(,1px,2px), s(,,solid,dashed))*/
:where(.\\$border\\(w\\(\\,1px\\,2px\\)\\,\\ s\\(\\,\\,solid\\,dashed\\)\\)) {
  border-inline-width: 1px;
  border-block-end-width: 2px;
  border-block-end-style: solid;
  border-inline-end-style: dashed;
}`,
    "$w(1px,2px,)":
/*css*/`/*container 0*/
/*$w(1px,2px,)*/
:where(.\\$w\\(1px\\,2px\\,\\)) {
  min-inline-size: 1px;
  inline-size: 2px;
}`,
    "$h(,2px,)":
/*css*/`/*container 0*/
/*$h(,2px,)*/
:where(.\\$h\\(\\,2px\\,\\)) {
  block-size: 2px;
}`,
    "$border(solid,2px)|.new$border(solid,4px,radius(1rem))|.sale$border(dashed,3px,radius(0.5rem))|*$border(double,2px,radius(0.25rem))":
/*css*/`/*container 0*/
/*$border(solid,2px)|.new$border(solid,4px,radius(1rem))|.sale$border(dashed,3px,radius(0.5rem))|*$border(double,2px,radius(0.25rem))*/\n:where(.\\$border\\(solid\\,2px\\)\\|\\.new\\$border\\(solid\\,4px\\,radius\\(1rem\\)\\)\\|\\.sale\\$border\\(dashed\\,3px\\,radius\\(0\\.5rem\\)\\)\\|\\*\\$border\\(double\\,2px\\,radius\\(0\\.25rem\\)\\)) {
  border-style: solid;
  border-width: 2px;
}
/*item 1*/
/*$border(solid,2px)|.new$border(solid,4px,radius(1rem))|.sale$border(dashed,3px,radius(0.5rem))|*$border(double,2px,radius(0.25rem))*/
:where(.\\$border\\(solid\\,2px\\)\\|\\.new\\$border\\(solid\\,4px\\,radius\\(1rem\\)\\)\\|\\.sale\\$border\\(dashed\\,3px\\,radius\\(0\\.5rem\\)\\)\\|\\*\\$border\\(double\\,2px\\,radius\\(0\\.25rem\\)\\)) >
:where(.new) {
  border-style: solid;
  border-width: 4px;
  border-radius: 1rem;
}
/*item 1*/
/*$border(solid,2px)|.new$border(solid,4px,radius(1rem))|.sale$border(dashed,3px,radius(0.5rem))|*$border(double,2px,radius(0.25rem))*/
:where(.\\$border\\(solid\\,2px\\)\\|\\.new\\$border\\(solid\\,4px\\,radius\\(1rem\\)\\)\\|\\.sale\\$border\\(dashed\\,3px\\,radius\\(0\\.5rem\\)\\)\\|\\*\\$border\\(double\\,2px\\,radius\\(0\\.25rem\\)\\)) >
:where(.sale) {
  border-style: dashed;
  border-width: 3px;
  border-radius: 0.5rem;
}
/*item 0*/
/*$border(solid,2px)|.new$border(solid,4px,radius(1rem))|.sale$border(dashed,3px,radius(0.5rem))|*$border(double,2px,radius(0.25rem))*/
:where(.\\$border\\(solid\\,2px\\)\\|\\.new\\$border\\(solid\\,4px\\,radius\\(1rem\\)\\)\\|\\.sale\\$border\\(dashed\\,3px\\,radius\\(0\\.5rem\\)\\)\\|\\*\\$border\\(double\\,2px\\,radius\\(0\\.25rem\\)\\)) >
:where(*) {
  border-style: double;
  border-width: 2px;
  border-radius: 0.25rem;
}`,
    "$color(black, #123456, b(red))":
/*css*/`/*container 0*/
/*$color(black, #123456, b(red))*/
:where(.\\$color\\(black\\,\\ \\#123456\\,\\ b\\(red\\)\\)) {
  color: black;
  --background-color: #123456;
  border-color: red;
}`,
    "$color(black, #123456, green)":
/*css*/`/*container 0*/
/*$color(black, #123456, green)*/
:where(.\\$color\\(black\\,\\ \\#123456\\,\\ green\\)) {
  color: black;
  --background-color: #123456;
  border-color: green;
}`,
    "$color(black, #123456, green:yellow)":
/*css*/`/*container 0*/
/*$color(black, #123456, green:yellow)*/
:where(.\\$color\\(black\\,\\ \\#123456\\,\\ green\\:yellow\\)) {
  color: black;
  --background-color: #123456;
  border-block-color: green;
  border-inline-color: yellow;
}`,
    "$border(thin,2px)": `Property crash: width vs width`,
    "$border(2px,w(,,3px))": `Property crash: width vs width-block-end`,
    "$border(s(,dashed), solid)": `Property crash: style-inline vs style`,
    "$border(thin)":
/*css*/`/*container 0*/
/*$border(thin)*/
:where(.\\$border\\(thin\\)) {
  border-width: thin;
}`,
    "$color(rgb(0,12,255))":
/*css*/`/*container 0*/
/*$color(rgb(0,12,255))*/
:where(.\\$color\\(rgb\\(0\\,12\\,255\\)\\)) {
  color: rgb(0,12,255);
}`,
    "$w(min)":
/*css*/`/*container 0*/
/*$w(min)*/
:where(.\\$w\\(min\\)) {
  inline-size: min-content;
}`,
    "$w(min,2px,max)":
/*css*/`/*container 0*/
/*$w(min,2px,max)*/
:where(.\\$w\\(min\\,2px\\,max\\)) {
  min-inline-size: min-content;
  inline-size: 2px;
  max-inline-size: max-content;
}`,
  };
  for (let [expr, expect] of Object.entries(units).reverse()) {
    let res;
    try {
      res = toCss(expr);
    } catch (err) {
      res = err.message;
    }
    if (res != expect) {
      let i = -1;
      while (i++ < res.length)
        if (res[i] != expect[i])
          break;
      console.log("FAIL", expr);
      console.log(JSON.stringify(res.substring(i, i + 40)));
      console.log(JSON.stringify(expect.substring(i, i + 40)));
      console.log("------------------------");
    } else {
      console.log("OK", expr);
    }
  }

</script>