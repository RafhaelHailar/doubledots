function B(n,t){if(n===".")return t;for(let e of n.split("."))if(!(t=t?.[e]))return t===0?t:"";return t}function _(n,t){return n.replace(/\{\{([^}{]+)\}\}/g,(e,r)=>B(r,t))}function*R(n,t,e=[]){if(n instanceof Element){if(e.length){for(let r of n.attributes)if(r.name.startsWith(t))return}for(let{name:r,value:o}of n.attributes)o.indexOf("{{")>=0&&(yield(s,i)=>e.reduce((c,a)=>c.childNodes[a],s).setAttribute(r,_(o,i)));for(let r=0;r<n.childNodes.length;r++)yield*R(n.childNodes[r],t,[...e,r])}else if(n instanceof Text){let r=n.textContent;r.indexOf("{{")>=0&&(yield(o,s)=>e.reduce((i,c)=>i.childNodes[c],o).textContent=_(r,s))}}function q(n){this.__tasks??=[...R(this.ownerElement,this.trigger+":")];for(let t of this.__tasks)t(this.ownerElement,n);return n}var w={".":"this.","e.":"window.eventLoop.event.","t.":"window.eventLoop.event.target.","w.":"window.","d.":"window.document.","oi.":"oi.","at.":"window.eventLoop.attribute.","el.":"window.eventLoop.attribute.ownerElement.","this.":"this.","window.":"window.","document.":"document."};function T(n){for(let t in w)if(n.startsWith(t))return DoubleDots.kebabToPascal(w[t]+n.slice(t.length))}var S=/^((-?\d+(\.\d+)?([eE][-+]?\d+)?)|this|window|document|i|e|true|false|undefined|null)$/;function x(n){let[t,...e]=n.split("_"),r=T(t);e=e.map(i=>T(i)||S.test(i)?i:`"${i}"`);let o=e.join(", "),s=e.length?e.length===1?`=${o}`:`=[${o}]`:"";return`(${r} instanceof Function ? ${r}(${o}) : (${r}${s}))`}function F(n){let e=`function dotReaction(oi) { return ${x(n)}; }`;return DoubleDots.importBasedEval(e)}function W(n){let e=`function dotReaction(oi) { return ${x(n.slice(2))} || EventLoop.break; }`;return DoubleDots.importBasedEval(e)}function j(n){let e=`function dotReaction(oi) { return ${x(n.slice(2))} && EventLoop.break; }`;return DoubleDots.importBasedEval(e)}function I(n){let t=parseInt(n.slice(2));if(!t||isNaN(t))throw new DoubleDots.SyntaxError("ReactionJump only accept positive and negative integers: "+n.slice(2));return DoubleDots.importBasedEval(`_ => new EventLoop.ReactionJump(${t})`)}var h={};for(let n in w)h[n]=F;h["x."]=W,h["y."]=j,h["j."]=I;var g=class{constructor(t){this.posts=t}*parents(t,e,r){for(let[o,s]of Object.entries(this.posts))(!e||o.startsWith(e))&&r&&Array.isArray(s[r])&&s[r].includes(t)&&(yield o)}parent(t,e,r){return this.parents(t,e,r).next().value}resolve(t,e){let r=Object.assign({},e,this.posts[t]);for(let o in r)r[o]instanceof Array&&(r[o]=r[o].map(s=>this.resolve(s,e)));return r}},O=new DoubleDots.AttrWeakSet,$=class extends AttrCustom{upgrade(){O.add(this)}},E=class extends Event{constructor(t,e){super(t),this.er=new g(e)}};function z(n){eventLoop.dispatchBatch(new E("er",n),O)}async function Q(){return(await fetch(this.value)).json()}async function V(){return(await fetch(this.value)).text()}var v=class{constructor(t,e=Attr){this.elIt=document.createNodeIterator(t,NodeFilter.SHOW_ELEMENT),this.Type=e,this.attr=void 0,this.nextElement()}nextElement(){this.el=this.elIt.nextNode(),this.i=0,this.attributes=this.el?Array.from(this.el.attributes):[]}next(){for(;this.el?.isConnected;){for(;this.i<this.attributes.length;)if(this.attr=this.attributes[this.i++],this.attr.ownerElement&&this.attr instanceof this.Type)return{value:this.attr,done:!1};this.nextElement()}return this.attr=void 0,{done:!0}}[Symbol.iterator](){return this}},y=class extends v{constructor(t,e=Attr){super(t,e),this.stack=[]}next(){let t=super.next();if(t.done)return t;for(;this.stack.length&&!this.stack[0].el.contains(this.el);)this.stack.shift();let e=this.makePath(t.value,this.stack[0]?.path);return this.stack.unshift(e),t}makePath({ownerElement:t,value:e},r=[]){return e=e.split("."),e=e[0]?e:[...r,...e.slice(1)],{el:t,path:e}}get currentPath(){return this.stack[0].path}};function M(n){for(;n;n=n.parentElement)if(n.pp)return n.pp}var b=class extends Event{constructor(t,e,r){super(t),this.IT=r,this.root=e}get[Event.data](){let t=this.root,e;for(e of l.currentPath)t=t?.[e];return t instanceof Object?Object.assign({"#key":e},t):{"#key":e,"#value":t}}};function L(n,t){l=new y(n,p),eventLoop.dispatchBatch(new b("pp",t,l),l)}var l;function Y(n){if(l?.attr)throw new Error(":pp reaction cannot be triggered while the pp: is propagating");this.ownerElement.pp=n,n&&L(this.ownerElement,n)}var p=class extends AttrCustom{upgrade(){for(let t of this.ownerElement.attributes)if(t!==this&&t instanceof p)throw new Error("An element can only hold one "+this.trigger+":")}set value(t){if(super.value=t,l?.attr){if(l.attr===this)throw new Error("reactions on pp: trigger cannot change their own value!");if(!l.attr.ownerElement.contains(this.ownerElement))throw new Error("pp: mutation outside scope: "+l.attr.ownerElement+" >! "+this.ownerElement);return}let e=M(this.ownerElement);e&&L(this.ownerElement,e)}get value(){return super.value}};function H(n,t,e){let r=n.cloneNode(!0);for(let o of r.children)for(let s of o.attributes)if(s.name.startsWith(e))return s.value="."+t,r;return r}function Z(n,t){if(!(n instanceof DocumentFragment)||!n.children.length)throw new Error("loop #1 argument must be a DocumentFragment with at least one child element.");if(typeof t!="object")throw new Error("loop #2 argument is not an object.");let e=this.trigger+":";this.ownerElement.textContent="";let r=t instanceof Array?t.map((o,s)=>s):Object.keys(t).filter(o=>!o.startsWith("#"));for(let o of r)this.ownerElement.append(...H(n,o,e).childNodes);return t}var f=class{static compareSmall(t,e){let r=new Array(e.length),o=[];if(!t?.length)return{exact:r,unused:o};t:for(let s=0;s<t.length;s++){for(let i=0;i<e.length;i++)if(!r[i]&&t[s]===e[i]){r[i]=s;continue t}o.push(s)}return{exact:r,unused:o}}constructor(t,e){this.root=t,this.template=e,this.tl=e.childNodes.length,this.now=[],this.root.textContent=""}getTemplClone(){return this.template.cloneNode(!0).childNodes}moveToRes(t,e,r,o,s){t*=s,e*=s;for(let i=0;i<s;i++)r[t+i]=o[e+i]}step(t=[]){let e=this.now;this.now=t;let{exact:r,unused:o}=f.compareSmall(e,t),s=this.root.childNodes,i=new Array(t.length*this.tl);for(let a=0;a<r.length;a++){let u=r[a];u!=null?this.moveToRes(a,u,i,s,this.tl):(o.length?this.moveToRes(a,o.pop(),i,s,this.tl):this.moveToRes(a,0,i,this.getTemplClone(),this.tl),this.task(i,a))}let c=[];for(let a=o.pop(),u=0;a!=null;u++,a=o.pop())this.moveToRes(u,a,c,s,this.tl);return i}task(t){}},k=class extends f{constructor(t,e){super(t.ownerElement,e),this.attr=t,this.triggerName=t.trigger+":"}task(t,e){for(let r=0,o=e*this.tl;r<this.tl;r++)if(t[o+r].attributes){for(let s of t[o+r].attributes)if(s.name.startsWith(this.triggerName))return s.value="."+e}}};function P(n,t){let e="pp";if(!Array.isArray(t))throw new Error("loop #2 argument is not an array.");if(!(n instanceof DocumentFragment)||!n.children.length)throw new Error("loop #1 argument must be a DocumentFragment with at least one child element.");let r=(this.__loop??=new k(this,n)).step(t);return r.length?this.ownerElement.append(...r):this.ownerElement.innerText="",t}var d=class extends AttrListener{get target(){return window}},m=class extends AttrListener{get target(){return document}},D=class extends m{get type(){return"DOMContentLoaded"}},N=class extends d{get type(){return this.trigger.slice(1)}get options(){return!0}},A=class extends d{get type(){return this.trigger.slice(-1)}};function J(){let n=e=>e[0].toUpperCase()+e.slice(1),t={};for(let e of DoubleDots.nativeEvents.element)e=n(e),t[e]=AttrListener,t["_"+e]=N,t[e+"_"]=A;for(let e of DoubleDots.nativeEvents.window)t[n(e)]=d;for(let e of DoubleDots.nativeEvents.document)t[n(e)]=m;return delete t.DOMContentLoaded,t.Domcontentloaded=D,t}var et=J();function C(n,t){t||=n.tagName.toLowerCase();let e=document.head.querySelector(`template[name="${t}"]`);if(e)return e.content;if(n=n.firstElementChild,n instanceof HTMLTemplateElement)return n.setAttribute("name",t),document.head.append(n),n.content}function rt(n){let[t,e]=n.split("_");return function(){return this.__template??=C(this.ownerElement,e)}}function ot(){return this.__template??=C(this.ownerElement,this.ownerElement.getAttribute("template"))}export{D as DCLTrigger,m as DocumentTrigger,$ as Er,A as PostPropTrigger,p as Pp,N as PrePropTrigger,d as WindowTrigger,q as brace,et as dynamicSimpleProp,h as dynamicsDots,z as er,Q as fetch_json,V as fetch_text,Z as loop,Y as pp,ot as template,rt as template_};
//# sourceMappingURL=ddx.js.map
