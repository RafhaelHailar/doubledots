<script type="module">
  import { toCss } from "./Xengine.js";

  const units = {
    "$flex(row-reverse, p(1%,,3%), gap(,3rem))":
/*css*/`/*container 0*/
/*$flex(row-reverse, p(1%,,3%), gap(,3rem))*/
:where(.\\$flex\\(row-reverse\\,\\ p\\(1\\%\\,\\,3\\%\\)\\,\\ gap\\(\\,3rem\\)\\)) {
  display: flex;
  flex-direction: row-reverse;
  padding-top: 1%;
  padding-bottom: 3%;
  padding-block-start: 1%;
  padding-block-end: 3%;
  gap-row: 3rem;
}`,
    "$border(radius(1rem))":
/*css*/`/*container 0*/
/*$border(radius(1rem))*/
:where(.\\$border\\(radius\\(1rem\\)\\)) {
  border-radius: 1rem;
}`,
    "$border(w(,1px,2px), s(,,solid,dashed))":
/*css*/`/*container 0*/
/*$border(w(,1px,2px), s(,,solid,dashed))*/
:where(.\\$border\\(w\\(\\,1px\\,2px\\)\\,\\ s\\(\\,\\,solid\\,dashed\\)\\)) {
  border-right-width: 1px;
  border-bottom-width: 2px;
  border-left-width: 1px;
  border-block-end-width: 2px;
  border-inline-width: 1px;
  border-bottom-style: solid;
  border-left-style: dashed;
  border-block-end-style: solid;
  border-inline-end-style: dashed;
}`,
    "$size(1px,2px)":
/*css*/`/*container 0*/
/*$size(1px,2px)*/
:where(.\\$size\\(1px\\,2px\\)) {
  block-size: 1px;
  inline-size: 2px;
}`,
    "$size(,2px)":
/*css*/`/*container 0*/
/*$size(,2px)*/
:where(.\\$size\\(\\,2px\\)) {
  inline-size: 2px;
}`,
    "$size(fit(2px))":
      `/*container 0*/
/*$size(fit(2px))*/
:where(.\\$size\\(fit\\(2px\\)\\)) {
  min-block-size: min-content;
  block-size: 2px;
  max-block-size: max-content;
}`,

    "$border(solid,2px)|.new$border(solid,4px,radius(1rem))|.sale$border(dashed,3px,radius(0.5rem))|*$border(double,2px,radius(0.25rem))":
/*css*/`/*container 0*/
/*$border(solid,2px)|.new$border(solid,4px,radius(1rem))|.sale$border(dashed,3px,radius(0.5rem))|*$border(double,2px,radius(0.25rem))*/\n:where(.\\$border\\(solid\\,2px\\)\\|\\.new\\$border\\(solid\\,4px\\,radius\\(1rem\\)\\)\\|\\.sale\\$border\\(dashed\\,3px\\,radius\\(0\\.5rem\\)\\)\\|\\*\\$border\\(double\\,2px\\,radius\\(0\\.25rem\\)\\)) {
  border-style: solid;
  border-width: 2px;
}
/*item 1*/
/*$border(solid,2px)|.new$border(solid,4px,radius(1rem))|.sale$border(dashed,3px,radius(0.5rem))|*$border(double,2px,radius(0.25rem))*/
:where(.\\$border\\(solid\\,2px\\)\\|\\.new\\$border\\(solid\\,4px\\,radius\\(1rem\\)\\)\\|\\.sale\\$border\\(dashed\\,3px\\,radius\\(0\\.5rem\\)\\)\\|\\*\\$border\\(double\\,2px\\,radius\\(0\\.25rem\\)\\)) >
:where(.new) {
  border-style: solid;
  border-width: 4px;
  border-radius: 1rem;
}
/*item 1*/
/*$border(solid,2px)|.new$border(solid,4px,radius(1rem))|.sale$border(dashed,3px,radius(0.5rem))|*$border(double,2px,radius(0.25rem))*/
:where(.\\$border\\(solid\\,2px\\)\\|\\.new\\$border\\(solid\\,4px\\,radius\\(1rem\\)\\)\\|\\.sale\\$border\\(dashed\\,3px\\,radius\\(0\\.5rem\\)\\)\\|\\*\\$border\\(double\\,2px\\,radius\\(0\\.25rem\\)\\)) >
:where(.sale) {
  border-style: dashed;
  border-width: 3px;
  border-radius: 0.5rem;
}
/*item 0*/
/*$border(solid,2px)|.new$border(solid,4px,radius(1rem))|.sale$border(dashed,3px,radius(0.5rem))|*$border(double,2px,radius(0.25rem))*/
:where(.\\$border\\(solid\\,2px\\)\\|\\.new\\$border\\(solid\\,4px\\,radius\\(1rem\\)\\)\\|\\.sale\\$border\\(dashed\\,3px\\,radius\\(0\\.5rem\\)\\)\\|\\*\\$border\\(double\\,2px\\,radius\\(0\\.25rem\\)\\)) >
:where(*) {
  border-style: double;
  border-width: 2px;
  border-radius: 0.25rem;
}`

  };
  for (let [expr, expect] of Object.entries(units)) {
    const res = toCss(expr);
    if (res != expect) {
      let i = -1;
      while (i++ < res.length)
        if (res[i] != expect[i])
          break;
      console.log("FAIL", expr);
      console.log(JSON.stringify(res.substring(i, i + 40)));
      console.log(JSON.stringify(expect.substring(i, i + 40)));
      console.log("------------------------");
    } else {
      console.log("OK", expr);
    }
  }

</script>