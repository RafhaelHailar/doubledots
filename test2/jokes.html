<script src="../../src/1_1_DoubleDots.js"></script>
<script src="../../src/1_2_AttrCustom.js"></script>
<script src="../../src/2_2_nativeMethods.js"></script>
<script src="../../src/3_definition_registers_v4.js"></script>
<script src="../../src/4_eventLoop_v2.js"></script>
<script src="../../src/6_load_DoubleDots.js"></script>
<script src="../../src/triggers/PropagationSimple.js"></script>

<div>
  <button
    click::load-json:displayone:hasdelivery:sleep_4000:displaytwo="https://v2.jokeapi.dev/joke/Programming?blacklistFlags=nsfw,religious,political,racist,sexist,explicit"
    >LOAD JOKE</button>
  <section></section>
</div>

<script>
  document.Reactions.defineRule("sleep_", function (fullname) {
    const ms = parseInt(fullname.split("_")[1]);
    return async oi => (await DoubleDots.sleep(ms), oi);
  });
  document.Reactions.define("load-json", async _ => await (await (fetch(this.value)).json()));
  document.Reactions.define("displayone", function (oi) {
    this.ownerElement.nextElementSibling.innerHTML = `<p>${oi.setup || oi.joke}</p>`;
  });
  document.Reactions.define("displaytwo", function (oi) {
    this.ownerElement.nextElementSibling.innerHTML = `<p>${oi.setup}</p><p>${oi.delivery}</p>`;
  });
  document.Reactions.define("hasdelivery", function (oi) {
    if(!oi.delivery)
      return EventLoop.Break;
  });
</script>